(function(c){function d(a){a=a.target;h.validCheck(a)?b.log("validation ok"):b.log("validation no");k(a.parentNode)}function k(a){for(var b=a.length-1,h=!0,e=b-1;0<=e;--e)if(!l.hasClass(a[e],"status-approved")){h=!1;break}h?l.removeClass(a[b],"hidden"):l.addClass(a[b],"hidden")}function f(b){var g=a.querySelector(".form-container");l.removeClass(g,"isProgressing");"success"==b&&e.ui.modal.closeModal(function(){updateTopbar(!0)})}var a=c.document,b=c.console,e=c.WILDGOOSE||{};e.account=e.account||
{};var m=CAGE.ajax,l=CAGE.util.dom,h=e.ui.validation;e.account={loginHandler:function(b){var g=a.querySelector(".form-container");l.removeClass(g,"isProgressing");200==JSON.parse(b).status&&(loginPopup.close(),updateTopbar(!0))},loginAccount:f,showSignUpResult:f,signUpAccount:function(){var b=a.querySelector(".form-container"),g=escape(b[0].value),b=escape(b[1].value),g="email\x3d"+g+"\x26password\x3d"+SHA256(b);m.POST({url:"/api/v1/accounts/",callback:f,data:g})},checkFormStatus:k,checkSignUpFrom:d,
addValidationEvent:function(){for(var b=a.querySelector(".form-container"),g=b.length-1;0<=g;--g){var l=b[g];"email"!=l.type&&"password"!=l.type||l.addEventListener("blur",d,!1)}}};"undefined"!==typeof module&&module.exports?module.exports=e:c.WILDGOOSE=e})(this);
(function(c){var d=c.document,k=c.console,f=c.WILDGOOSE||{};f.header=f.header||{};var a=CAGE.ui.popup,b=CAGE.util.template,e=f.account;f.header={init:function(){var c=d.querySelector("#join");(new a.ajaxPopup({element:c,templateUrl:"/api/v1/templates/account.html",templateLoader:function(a){return JSON.parse(a).data.template}})).afteropen.add(function(a){e.addValidationEvent();a.querySelector("#create").addEventListener("click",e.signUpAccount,!1)});c=d.querySelector("#login");c=new a.ajaxPopup({element:c,
templateUrl:"/api/v1/templates/login.html",templateLoader:function(a){var h=JSON.parse(a).data.template;a=JSON.parse(a).message;return b.getCompiler(h)({randNum:a},h)}});c.afteropen.add(function(a){a.querySelector("#create").addEventListener("click",e.loginAccount,!1)});c.afterclose.add(function(){location.reload()});d.querySelector(".header-btn#logout").addEventListener("click",function(){Ajax.DELETE({url:"/api/v1/session"});var a=d.querySelector(".header-btn#join"),b=d.querySelector(".header-btn#login"),
c=d.querySelector(".header-btn#logout"),g=d.querySelector(".header-btn#timeline"),e=d.querySelector(".header-btn#favorite");k.log(c);a.className="header-btn";b.className="header-btn";c.className="header-btn hidden";g.className="header-btn hidden";e.className="header-btn hidden"},!1);d.querySelector(".header-btn#timeline").addEventListener("click",function(){var a=getUserId();location.href="/users/?user_id?/timeline".replace("?user_id?",a)},!1);d.querySelector(".header-btn#favorite").addEventListener("click",
function(){var a=getUserId();location.href="/users/?user_id?/favorites".replace("?user_id?",a)},!1)}};"undefined"!==typeof module&&module.exports?module.exports=f:c.WILDGOOSE=f})(this);
(function(){var c=window.document,d=window.console,k=window.WILDGOOSE||{};k.ui=k.ui||{};k.ui.auto_complement=k.ui.auto_complement||{};var f=CAGE.ajax;k.ui.auto_complement={init:function(a){this.row={requestCount:a.requestNum,currentCount:0};this.interval=100;this.is={searching:!1,hovering:!1,pressedEnter:!1,listing:!1,highlighting:!1};this.box=c.querySelector(a.searchBox);this.list=c.querySelector(a.container);this.cache={searchedQuery:this.box.value,row:null,callbackRef:{notify:this.notify.bind(this),
expired:this.expired.bind(this),listHandler:this.listHandler.bind(this),drawList:this.drawList.bind(this),setHovering:this.setHovering.bind(this),observeState:this.observeState.bind(this)}};this.box.addEventListener("focus",this.cache.callbackRef.notify);this.box.addEventListener("blur",this.cache.callbackRef.expired);this.box.focus()},expired:function(a){!1!=this.is.searching&&!1==this.is.hovering&&(!0==this.is.listing&&this.removeList(),clearInterval(this.is.searching),this.is.searching=!1)},notify:function(a){!1==
this.is.searching&&(this.is.searching=setInterval(this.cache.callbackRef.observeState,this.interval))},observeState:function(){var a=this.box.value;a!=this.cache.searchedQuery&&(d.log("detection: "+a),""==a?this.removeList():this.search(a))},search:function(a){this.cache.searchedQuery=a;f.GET({url:"/api/v1/search?autocomplete\x3dtrue\x26q\x3d"+a+"\x26how_many\x3d"+this.row.requestCount,callback:this.cache.callbackRef.drawList})},drawList:function(a){this.is.pressedEnter=!1;a=JSON.parse(a).data.reporters;
d.log(a);if(void 0!==a&&0!=a.length){this.cache.row=null;this.row.currentCount=a.length;for(var b="",c=0;c<this.row.currentCount;c++)b+="\x3cli\x3e\x3cdiv\x3e"+a[c].name+"\x3c/div\x3e\x3c/li\x3e";this.list.innerHTML=b;this.addList()}},removeList:function(){this.is.listing=!1;this.row.currentCount=0;this.cache.row=null;this.list.style.display="none";this.removeMouseRader(this.list);this.box.removeEventListener("keydown",this.cache.callbackRef.listHandler,!1);this.list.removeEventListener("click",this.cache.callbackRef.listHandler,
!1);this.list.removeEventListener("mousemove",this.cache.callbackRef.listHandler,!1);this.is.hovering=!1},addList:function(){this.is.listing=!0;this.list.style.display="inline-block";this.addMouseRader(this.list);this.box.addEventListener("keydown",this.cache.callbackRef.listHandler,!1);this.list.addEventListener("click",this.cache.callbackRef.listHandler,!1);this.list.addEventListener("mousemove",this.cache.callbackRef.listHandler,!1)},addMouseRader:function(a){a.addEventListener("mouseover",this.cache.callbackRef.setHovering,
!1);a.addEventListener("mouseout",this.cache.callbackRef.setHovering,!1)},removeMouseRader:function(a){a.removeEventListener("mouseover",this.cache.callbackRef.setHovering,!1);a.removeEventListener("mouseout",this.cache.callbackRef.setHovering,!1)},setHovering:function(a){"mouseover"==a.type?this.is.hovering=!0:"mouseout"==a.type&&(this.is.hovering=!1)},listHandler:function(a){var b=a.target;"keydown"==a.type&&b==this.box?(d.log("keydown"),b=a.keyCode,38==b||40==b?(a.preventDefault(),this.highlightRow(39-
b)):13==b&&(a.preventDefault(),this.selectEl(this.list.children[this.cache.row]))):"click"==a.type&&b.parentNode.parentNode==this.list&&!0==this.is.hovering?(this.is.hovering=!1,this.selectEl(a.target)):"mousemove"==a.type&&!0==this.is.highlighting&&this.highlightOut(this.cache.row)},selectEl:function(a){var b=null,b=void 0===a?this.box.value:a.innerText,b=this.removeNewline(b);this.box.value=b;this.cache.searchedQuery=b;this.removeList();this.box.form.submit()},removeNewline:function(a){var b=a.lastIndexOf("\n");
return-1==b?a:a.substring(0,b)},highlightRow:function(a){null==this.cache.row&&(a=this.cache.row=0);var b=this.cache.row;a=b-a;a>=this.row.currentCount?a=0:0>a&&(a=this.row.currentCount-1);this.highlightOut(b);this.highlightIn(a);this.cache.row=a},highlightIn:function(a){this.is.highlighting=!0;this.list.children[a].className="highlight"},highlightOut:function(a){null!==a&&(this.is.highlighting=!1,this.list.children[a].className="")}}})();
window.addEventListener("load",function(c){WILDGOOSE.ui.auto_complement.init({searchBox:"#query-entry",container:".search .auto-completion-list",requestNum:7})},!1);
(function(){var c=window.document,d=window.console,k=CAGE.ajax,f=CAGE.util.dom,a=window.WILDGOOSE||{};a.ui=a.ui||{};a.favorite=a.favorite||{};var b={favoriteList:[],attatchEventToFavBtn:function(a,b){var e=c.querySelectorAll(".card");if(0!=e.length){void 0==a?a=e.length:!0;void 0==b?b=e.length:!0;for(var g=a-b;g<a;g++){var d=e[g];void 0!=d&&(d=d.querySelector(".star"),d.addEventListener("click",this.toggleFav,!1),d.addEventListener("click",function(a){f.addClass(a.target,"pumping");setTimeout(function(){f.removeClass(a.target,
"pumping")},300)},!1))}}},toggleFav:function(a){var b=a.target,c=b.parentElement.parentElement.parentElement;a=c.firstElementChild.dataset.reporter_id;a="/api/v1/users/"+getUserId()+"/favorites/?reporter_id\x3d"+a;f.hasClass(b,"on")?k.DELETE({url:a,callback:function(a){a=JSON.parse(a);200==a.status&&(f.removeClass(b,"on"),f.addClass(b,"off"),f.addClass(c,"blur"))}}):k.POST({url:a,callback:function(a){a=JSON.parse(a);200==a.status&&(f.addClass(b,"on"),f.removeClass(b,"off"),f.removeClass(c,"blur"))}})},
updateFavs:function(a,b){var e=c.querySelectorAll(".card-section-identity");if(0!=e.length){void 0==a?a=e.length:!0;void 0==b?b=e.length:!0;for(var g=a-b;g<a;g++){var d=e[g];void 0!=d&&0<=this.favoriteList.indexOf(parseInt(d.dataset.reporter_id))&&(d.querySelector(".star").className="star on")}}}};if(isUserLogined()){var e=getUserId();b.attatchEventToFavBtn();var m="/api/v1/users/"+e+"/favorites/";k.GET({url:m,callback:function(a){d.log(m);a=JSON.parse(a).data.reporterCards;for(var c=0;c<a.length;c++)b.favoriteList.push(a[c].id);
b.updateFavs()}})}a.ui.favorite=b})();
(function(){var c=window.document,d=window.WILDGOOSE||{};d.ui=d.ui||{};d.ui.search_more=d.ui.search_more||{};var k=CAGE.ajax,f=CAGE.util.template,a=d.ui.favorite;d.ui.search_more={_more:function(a){a=c.querySelector(".search-more .state-search-query").innerText;var e=c.querySelector(".search-more .state-search-curNum").innerText;k.GET({url:"/api/v1/search?q\x3d"+a+"\x26start_item\x3d"+e+"\x26how_many\x3d"+this.requestNum,callback:this._responseHandler.bind(this)})},_responseHandler:function(b){b=
JSON.parse(b).data.reporters;var c=null!=this._getUserId()?!0:!1;if(0!=b.length){b=this._makeReporterCards(c,b);this._attachRecievedData(b);b=this._updateMetaData(b.length);this._selectStatusOfSearchMoreBtn(b.curNum);debugger;a.updateFavs(b.curNum,this.requestNum);a.attatchEventToFavBtn(b.curNum,this.requestNum)}},_updateMetaData:function(a){var e=c.querySelector(".search-more .state-search-curNum");a=parseInt(e.innerText)+a;e.innerText=a;return{curNum:a}},_selectStatusOfSearchMoreBtn:function(a){var e=
c.querySelector(".search-more"),d=c.querySelector(".search-more .state-search-totalNum");null===d?e.setAttribute("style","display: none;"):parseInt(d.innerText)<=a&&e.setAttribute("style","display: none;")},_makeReporterCards:function(a,c){for(var d=f.getCompiler(),k=c.length,h=[],n=0;n<k;n++){var g='\x3cli class\x3d"card card-reporter"\x3e'+d(c[n],this.template)+"\x3c/li\x3e";h.push(g)}return h},_getUserId:function(){var a=c.getElementById("userId");null!=a&&(a=c.getElementById("userId").getAttribute("email"));
return a},_attachRecievedData:function(a){this.searchResult.innerHTML+=a.join("")},init:function(a){this.searchMoreBtn=c.querySelector(a.button);this.searchResult=c.querySelector(a.container);this.requestNum=a.requestNum;this.template=f.get({url:a.templateUrl});null!=this.searchMoreBtn&&(this.searchMoreBtn.addEventListener("click",this._more.bind(this),!1),this._selectStatusOfSearchMoreBtn())}}})();
window.addEventListener("load",function(c){WILDGOOSE.ui.search_more.init({button:".search-more",container:".search-result \x3e ul",templateUrl:"/api/v1/templates/reporterCard.html",requestNum:24})},!1);
(function(c){function d(a,b){l.GET({url:"api/v1/accounts/?email\x3d"+a.value,callback:function(a){e.log(a);a=200===JSON.parse(a).status?!0:!1;b(a,!0)}});Util.addClass(a,"isProgressing")}function k(a){h.removeClass(a,"status-denied");h.removeClass(a,"isInvalid");h.addClass(a,"status-approved");h.addClass(a,"isValid")}function f(a){h.removeClass(a,"status-approved");h.removeClass(a,"isValid");h.addClass(a,"status-denied");h.addClass(a,"isInvalid")}function a(a,c){b.querySelector(".form-container .msg-"+
a.name).innerText=c}var b=c.document,e=c.console,m=c.WILDGOOSE||{};m.ui=m.ui||{};m.ui.validation=m.ui.validation||{};var l=CAGE.ajax,h=CAGE.util.dom,n={email:{sequence:["required","format","usable"],required:[/.+/,"email을 입력해주세요"],format:[/^[\w\.-_\+]+@[\w-]+(\.\w{2,4})+$/,"email형식을 지켜주세요"],usable:[function(a,b){d(a,b)},"이미 등록된 email입니다"]},password:{sequence:["required","letter","size","ampleNumber","ampleLetter"],required:[/.+/,"비밀번호를 입력해주세요"],letter:[/[a-zA-Z0-9\`\~\!\@\#\$\%\^\&|*\(\)\-\_\=\=\+\\\|\,\.\<\>\/\?\[\]\{\}\;\:\'\"]/,
"숫자, 영문자 대소문자, 특수문자만 사용해주세요"],size:[/^.{8,15}$/,"8~15자 사이로 입력해주세요"],ampleNumber:[/(.*\d{1}.*){4,}/,"숫자는 4자리 이상 포함되어야 합니다"],ampleLetter:[/(.*\D{1}.*){4,}/,"문자는 4자리 이상 포함되어야 합니다"]},confirm:{sequence:["required","equal"],required:[/.+/,"다시 입력해주세요"],equal:[function(a,c){var d=b.querySelector("."+a.parentNode.className+" input[name\x3dpassword]");c(a.value==d.value)},"다시 확인해주세요"]}};m.ui.validation={validCheck:function(c){for(var d=c.name,h=c.value,m=n[d].sequence,l=0;l<m.length;++l){var p=n[d][m[l]],q=
p[1];if(p[0]instanceof RegExp){if(e.log("RegExp"),e.log(p[0].test(h)),!p[0].test(h))return a(c,q),f(c),!1}else if(p[0]instanceof Function){e.log("Function");var r=!0;p[0](c,function(b,d){d&&Util.removeClass(c,"isProgressing");if(!b)return a(c,q),f(c),r=!1});if(!r)return!1}}b.querySelector(".form-container .msg-"+c.name).innerText="";k(c);return!0}};"undefined"!==typeof module&&module.exports?module.exports=m:c.WILDGOOSE=m})(this);