(function(){var e=window.document,c=window.WILDGOOSE||{};c.user=c.user||{};c.user={getId:function(){var c=e.getElementById("userId");if(void 0!==c)return this.userId=c.innerText},isLogined:function(){return""==this.getId()?!1:!0}};"undefined"!==typeof module&&module.exports?module.exports=c:window.WILDGOOSE=c})();
(function(){var e=window.document,c=window.console,b=window.WILDGOOSE||{};b.ui=b.ui||{};b.favorite=b.favorite||{};var a=CAGE.ajax,h=CAGE.util.dom,d={favoriteList:[],attatchEventToFavBtn:function(a,g){var f=e.querySelectorAll(".card");if(0!=f.length){void 0==a?a=f.length:!0;void 0==g?g=f.length:!0;for(var d=a-g;d<a;d++){var c=f[d];void 0!=c&&(c=c.querySelector(".star"),c.addEventListener("click",this.toggleFav,!1),c.addEventListener("click",function(a){h.addClass(a.target,"pumping");setTimeout(function(){h.removeClass(a.target,
"pumping")},300)},!1))}}},toggleFav:function(d){var g=d.target,f=g.parentElement.parentElement.parentElement;d="/api/v1/users/"+this.userId+"/favorites/?reporter_id\x3d"+f.firstElementChild.dataset.reporter_id;h.hasClass(g,"on")?a.DELETE({url:d,callback:function(a){a=JSON.parse(a);200==a.status&&(h.removeClass(g,"on"),h.addClass(g,"off"),h.addClass(f,"blur"))}}):a.POST({url:d,callback:function(a){a=JSON.parse(a);200==a.status&&(h.addClass(g,"on"),h.removeClass(g,"off"),h.removeClass(f,"blur"))}})},
updateFavs:function(a,g){var f=e.querySelectorAll(".card-section-identity");if(0!=f.length){void 0==a?a=f.length:!0;void 0==g?g=f.length:!0;for(var d=a-g;d<a;d++){var c=f[d];void 0!=c&&0<=this.favoriteList.indexOf(parseInt(c.dataset.reporter_id))&&(c.querySelector(".star").className="star on")}}},init:function(h){this.userId=h.userId;""!==this.userId&&(this.attatchEventToFavBtn(),a.GET({url:"/api/v1/users/"+this.userId+"/favorites/",callback:function(a){c.log(a);a=JSON.parse(a).data.reporterCards;
for(var f=0;f<a.length;f++)d.favoriteList.push(a[f].id);this.updateFavs()}.bind(this)}))}};b.ui.favorite=d;"undefined"!==typeof module&&module.exports?module.exports=b:window.WILDGOOSE=b})();
(function(){var e=window.console,c=window.WILDGOOSE||{};c.ui=c.ui||{};c.ui.graph=c.ui.graph||{};var b=CAGE.ajax;c.ui.graph={brokenLine:function(a){var c=JSON.parse(a).data.numberOfArticles;a=d3.select("#brokenline-graph \x3e .graph").append("svg").style("width","100%").style("height",300).attr("id","brokenLineGraph").attr("viewBox","0 0 520 360");a.append("rect").attr("width","100%").attr("height","100%").attr("fill","#26A88E");a.selectAll("text").data([{y_pos:285,num:"0"},{y_pos:235,num:"1"},{y_pos:185,
num:"2"},{y_pos:135,num:"3"},{y_pos:85,num:"4"}]).enter().append("text").attr("x",7).attr("font-size","18").attr("fill","white").attr("y",function(a){return a.y_pos}).text(function(a){return a.num});guidanceLinePosition=["M 45 85 H520","M 45 135 H520","M 45 185 H520","M 45 235 H520","M 45 285 H520"];a.selectAll("path").data(guidanceLinePosition).enter().append("path").attr("d",function(a){return a}).attr("stroke","#7D7D7D").attr("stroke-width",1).style("stroke-dasharray","5,8").attr("stroke-opacity",
0.6).attr("fill","none");matching=[{0:285,1:235,2:185,3:135,4:85}];graphPositionX=[50,120,190,260,330,400,470];var d=[],b=new Date;b.setDate(b.getDate()-7);for(var g=0;7>g;g++){b.setDate(b.getDate()+1);var f=b.getMonth()+1;10>f&&(f="0"+f);var n=b.getDate();10>n&&(n="0"+n);d.push(f+"/"+n)}b=function(a){for(var f=0;f<c.length;f++){var d=c[f];if(d.date==a)return d.count}return 0};b=[{x:graphPositionX[0],y:matching[0][b(d[0])]},{x:graphPositionX[1],y:matching[0][b(d[1])]},{x:graphPositionX[2],y:matching[0][b(d[2])]},
{x:graphPositionX[3],y:matching[0][b(d[3])]},{x:graphPositionX[4],y:matching[0][b(d[4])]},{x:graphPositionX[5],y:matching[0][b(d[5])]},{x:graphPositionX[6],y:matching[0][b(d[6])]}];e.log(b);f=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear");a.append("path").attr("stroke","white").attr("stroke-width",2).attr("fill","none").attr("stroke-linecap","round").attr("d",f(b));a.append("text").attr("x",370).attr("y",40).attr("font-size","20").attr("fill","white").text("기사송고추이");
for(g in d)d[g]=d[g].replace("-","/");for(labelIndex=0;labelIndex<d.length;labelIndex++)a.append("text").attr("font-size","18").attr("fill","white").attr("y",315).attr("x",20+70*labelIndex).text(d[labelIndex])},radar:function(a){function c(a,f){var d=a.x*Math.cos(f)-a.y*Math.sin(f),g=a.x*Math.sin(f)+a.y*Math.cos(f);return{x:d,y:g}}var d={"통솔":10*Math.random(),"매력":10*Math.random(),"지력":10*Math.random(),"정치":10*Math.random(),"무력":10*Math.random()};a={"container-width":400,"container-height":400,"circle-scale":0.75,
color:"red"};var b=d3.select("#radar-graph \x3e .graph").append("svg").style("width","100%").style("height","300px").attr("id","radarGraph").attr("viewBox","0 0 400 400");b.append("rect").attr("width","100%").attr("height","100%").attr("fill","#FFF");for(var g=a["container-width"]/2*a["circle-scale"],f=0;10>f;f++)b.append("ellipse").attr("cx",a["container-width"]/2).attr("cy",a["container-height"]/2).attr("rx",g*(1-0.1*f)).attr("ry",g*(1-0.1*f)).attr("stroke","#AAA").attr("stroke-width",0.5).attr("fill",
"white").attr("fill-opacity",0);var e=Object.keys(d).length,f=0,l=[],p;for(p in d){var k={x:0,y:-1*d[p]/10*g},k=c(k,2*Math.PI/e*f);k.x+=a["container-width"]/2;k.y+=a["container-height"]/2;l.push(k);f++}l.push(l[0]);p=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear");for(var q=[],f=0;f<e;f++){var k={x:0,y:-1*g},k=c(k,2*Math.PI/e*f),r={x:0,y:-1*(g+25)},r=c(r,2*Math.PI/e*f);k.x+=a["container-width"]/2;k.y+=a["container-height"]/2;k.title=Object.keys(d)[f];k.value=
d[k.title];k.x_t=r.x+a["container-width"]/2;k.y_t=r.y+a["container-height"]/2;q.push(k)}for(d=0;d<q.length;d++)b.append("path").attr("d",p([q[d],{x:a["container-width"]/2,y:a["container-width"]/2}])).attr("stroke","#AAA").attr("stroke-width",0.5).attr("fill","yellow").attr("fill-opacity",0.6);b.append("path").attr("d",p(l)).attr("stroke","#222").attr("stroke-width",0.5).attr("stroke-opacity",0.1).attr("fill",a.color).attr("fill-opacity",0.4);b.selectAll("text").data(q).enter().append("text").attr("x",
function(a){return a.x_t-16}).attr("y",function(a){return"통솔"===a.title?a.y_t+1:a.y_t-4}).text(function(a){return a.title}).attr("font-family","sans-serif").attr("font-size","18px").attr("fill","#AAA").append("svg:tspan").attr("x",function(a){return a.x_t-16}).attr("dy",20).attr("font-size","23px").attr("fill","#444").text(function(a){return parseInt(10*a.value)/10})},donut:function(a){e.log(a);var b=JSON.parse(a).data.numberOfArticles;e.log(b);var d=d3.scale.category20c();a=d3.select("#donut-graph \x3e .graph").append("svg").data([b]).attr("viewBox",
"0 0 300 300").attr("style","width: 100%; height: 300px;").append("svg:g").attr("transform","translate(150,150)");var c=d3.svg.arc().outerRadius(120),g=d3.layout.pie().value(function(a){return a.value});a=a.selectAll("g.slice").data(g).enter().append("svg:g").attr("class","slice");a.append("svg:path").attr("fill",function(a,g){return d(g)}).attr("d",c);a.append("svg:text").attr("transform",function(a){a.innerRadius=0;a.outerRadius=100;return"translate("+c.centroid(a)+")"}).attr("text-anchor","middle").text(function(a,
d){return b[d].label}).attr("font-family","sans-serif").attr("font-size","18px").attr("fill","#FFF")},init:function(){var a=window.location.pathname.split("/")[2],c={donut:{url:"/api/v1/reporters/:reporterId/statistics?data\x3dnumber_of_articles\x26by\x3dsection",callback:this.donut},brokenLine:{url:"/api/v1/reporters/:reporterId/statistics?data\x3dnumber_of_articles\x26by\x3dday",callback:this.brokenLine},radar:{url:"/api/v1/reporters/:reporterId/statistics?data\x3dstat_points",callback:this.radar}},
d;for(d in c){var e=c[d],g=e.url.replace(":reporterId",a);b.GET({url:g,callback:e.callback.bind(this)})}}}})();
(function(e){function c(a,f){this.rule=f;this.myLogics={};this.mySequence={};this.UI.form=a;this.defineLogics()}var b=e.document,a=e.WILDGOOSE||{};a.validator=a.validator||{};var h=CAGE.util.object.extend,d=CAGE.util.dom,m=CAGE.ajax;c.prototype={constructor:"Validator",defineLogics:function(){for(var a in this.rule){var f=this.rule[a].type;this.myLogics[a]=h({},this.normLogics[f]);this.defineSequence(a,f,this.rule[a].extend);this.defineFunction(a,this.rule[a].extend);"confirm"==f&&(this.myLogics[a].target=
this.rule[a].target)}},defineSequence:function(a,f,d){this.mySequence[a]=[].concat(this.normSequence[f]);if(void 0!==d)for(f=Object.keys(d),d=0;d<f.length;++d){var c=f[d];-1==this.mySequence[a].indexOf(c)&&this.mySequence[a].push(c)}},defineFunction:function(a,d){for(var c in this.mySequence[a]){var b=this.mySequence[a][c];void 0!==d&&d.hasOwnProperty(b)?this.myLogics[a][b]=d[b]:void 0!==this.myLogics[a][b]&&null===this.myLogics[a][b][0]&&(this.myLogics[a][b][0]=this.normFunction[b])}},check:function(a){for(var d=
a.name,b=this.myLogics[d],d=this.mySequence[d],c=!0,e=0;e<d.length;++e){var h=d[e],m=b[h][1];if(!this._isValid(b[h][0],a)){c=!1;break}}this.UI.update(c,a,m);return c},_isValid:function(a,f){var b=f.name,c=f.value;if(a instanceof RegExp)return a.test(c);if(a instanceof Function){var e=!1;a.call(this.myLogics[b],f,function(a,b){b&&d.removeClass(f,"isProgressing");e=a});return e}return!1},normFunction:{usable:function(a,d){m.GET({isAsync:!1,url:"/api/v1/accounts?email\x3d"+a.value,success:function(a){d(!0,
!0)},failure:function(a){d(!1,!0)}})},equal:function(a,d){var c=b.querySelector("."+a.form.className+" input[name\x3d"+this.target+"]");d(a.value==c.value)}},normSequence:{email:["required","format","usable"],password:["required","letter","size","ampleNumber","ampleLetter"],confirm:["required","equal"]},normLogics:{email:{required:[/.+/,"email을 입력해주세요"],format:[/^[\w\.-_\+]+@[\w-]+(\.\w{2,4})+$/,"email형식을 지켜주세요"],usable:[null,"이미 등록된 email입니다"]},password:{required:[/.+/,"비밀번호를 입력해주세요"],letter:[/[a-zA-Z0-9\`\~\!\@\#\$\%\^\&|*\(\)\-\_\=\=\+\\\|\,\.\<\>\/\?\[\]\{\}\;\:\'\"]/,
"숫자, 영문자 대소문자, 특수문자만 사용해주세요"],size:[/^.{8,15}$/,"8~15자 사이로 입력해주세요"],ampleNumber:[/(.*\d{1}.*){4,}/,"숫자는 4자리 이상 포함되어야 합니다"],ampleLetter:[/(.*\D{1}.*){4,}/,"문자는 4자리 이상 포함되어야 합니다"]},confirm:{required:[/.+/,"다시 입력해주세요"],equal:[null,"다시 확인해주세요"]}},UI:{update:function(a,d,b){a?(this._unwarn(d),this._validStyle(d)):(this._warn(d,b),this._invalidStyle(d))},_validStyle:function(a){a=a.parentNode.parentNode.parentNode;d.removeClass(a,"is-invalid");d.addClass(a,"is-valid")},_invalidStyle:function(a){a=a.parentNode.parentNode.parentNode;
d.removeClass(a,"is-valid");d.addClass(a,"is-invalid")},_warn:function(a,d){this.form.querySelector(".msg-"+a.name).innerText=d},_unwarn:function(a){this.form.querySelector(".msg-"+a.name).innerText=""}}};a.validator=c;"undefined"!==typeof module&&module.exports?module.exports=a:e.WILDGOOSE=a})(this);
(function(e){function c(a){this.selectedEl={};this.accountObserver=this.validator=this.url=this.form=this.names=this.rule=this.method=this.randNum=this.submitEl=null;this.cache={keyEvtHandler:this._keyEvtHandler.bind(this)};this._account(a)}var b=e.document,a=e.console,h=e.WILDGOOSE||{};h.account=h.account||{};h.account.super_type=h.account.super_type||{};var d=CAGE.util.dom,m=CAGE.ajax,g=h.validator;c.prototype={constructor:"Account",_account:function(a){void 0!==a&&(this.method=a.method,this.rule=
a.rule,this.form=b.querySelector(a.form),this.url=a.url,this.randNum=a.randNum,void 0!==this.rule&&(this.names=Object.keys(this.rule),this._extract(),this.validator=new g(this.form,this.rule),this._addKeyEvent(),this._init()))},_getPayload:function(){return null},stop:function(){this._removeKeyEvent()},exec:function(b){if(void 0!==this.rule&&d.hasClass(this.submitEl,"disable"))a.log("누르지마 바보야");else m[this.method]({url:this.url,success:function(){b();a.log("Success!")},failure:function(){a.log("FAIL!")},
data:this._getPayload()})},_init:function(){for(var a in this.selectedEl){var d=this.selectedEl[a];""!=d.value&&this._validateField(d,!1)}},_extract:function(){for(var a=this.form.length-1;0<=a;--a){var d=this.form[a];"submit"==d.name?this.submitEl=d:void 0!==this.names&&-1!=this.names.indexOf(d.name)&&(this.selectedEl[d.name]=d)}},_addKeyEvent:function(){for(var a in this.selectedEl)this.selectedEl[a].addEventListener("keyup",this.cache.keyEvtHandler,!1)},_removeKeyEvent:function(){for(var a in this.selectedEl)this.selectedEl[a].removeEventListener("keyup",
this.cache.keyEvtHandler,!1)},_keyEvtHandler:function(a){var d=13==a.keyCode?!0:!1;this._validateField(a.target,d);d&&(a=new CustomEvent("click",{detail:{enter:d}}),this.submitEl.dispatchEvent(a))},_validateField:function(a,d){this.validator.check(a);this._updateUI(this._ckeckSubmitStatus(d))},_ckeckSubmitStatus:function(a){a=!0;for(var b in this.selectedEl){var c=this.selectedEl[b].parentNode.parentNode.parentNode;if(!d.hasClass(c,"is-valid")||d.hasClass(c,"is-invalid")){a=!1;break}}return a},_updateUI:function(a){a?
(d.removeClass(this.submitEl,"disable"),d.addClass(this.submitEl,"able")):(d.removeClass(this.submitEl,"able"),d.addClass(this.submitEl,"disable"))}};h.account.super_type=c;"undefined"!==typeof module&&module.exports?module.exports=h:e.WILDGOOSE=h})(this);
(function(e){function c(a){h.call(this,a)}var b=e.document,a=e.WILDGOOSE||{};a.account=a.account||{};a.account.change=a.account.change||{};a.account.change.pw=a.account.change.pw||{};var h=a.account.super_type;c.prototype=new h;c.prototype.constructor=c;c.prototype._getPayload=function(){var a=escape(b.getElementById("userId").textContent),c=SHA256(SHA256(escape(this.selectedEl.oldPassword.value))+this.randNum),e=SHA256(escape(this.selectedEl.newPassword.value));return"email\x3d"+a+"\x26old_pw\x3d"+
c+"\x26new_pw\x3d"+e};a.account.change.pw=c;"undefined"!==typeof module&&module.exports?module.exports=a:e.WILDGOOSE=a})(this);
(function(e){function c(b){a.call(this,b)}var b=e.WILDGOOSE||{};b.account=b.account||{};b.account.join=b.account.join||{};var a=b.account.super_type;c.prototype=new a;c.prototype.constructor=c;c.prototype._getPayload=function(){var a=escape(this.selectedEl.email.value),d=SHA256(escape(this.selectedEl.password.value));return"email\x3d"+a+"\x26password\x3d"+d};b.account.join=c;"undefined"!==typeof module&&module.exports?module.exports=b:e.WILDGOOSE=b})(this);
(function(e){function c(b){a.call(this,b)}var b=e.WILDGOOSE||{};b.account=b.account||{};b.account.logout=b.account.logout||{};var a=b.account.super_type;c.prototype=new a;c.prototype.constructor=c;b.account.logout=c;"undefined"!==typeof module&&module.exports?module.exports=b:e.WILDGOOSE=b})(this);
(function(e){function c(b){a.call(this,b)}var b=e.WILDGOOSE||{};b.account=b.account||{};b.account.login=b.account.login||{};var a=b.account.super_type;c.prototype=new a;c.prototype.constructor=c;c.prototype._getPayload=function(){var a=escape(this.selectedEl.email.value),d=SHA256(SHA256(escape(this.selectedEl.password.value))+this.randNum);return"email\x3d"+a+"\x26password\x3d"+d};b.account.login=c;"undefined"!==typeof module&&module.exports?module.exports=b:e.WILDGOOSE=b})(this);
(function(e){function c(a){h.call(this,a)}var b=e.document,a=e.WILDGOOSE||{};a.account=a.account||{};a.account.withdraw=a.account.withdraw||{};var h=a.account.super_type;c.prototype=new h;c.prototype.constructor=c;c.prototype._getPayload=function(){var a=escape(b.getElementById("userId").textContent),c=SHA256(SHA256(escape(this.selectedEl.password.value))+this.randNum);return"email\x3d"+a+"\x26password\x3d"+c+"\x26check\x3dwithdraw"};a.account.withdraw=c;"undefined"!==typeof module&&module.exports?
module.exports=a:e.WILDGOOSE=a})(this);
(function(e){var c=e.document,b=e.console,a=e.WILDGOOSE||{};a.modal=a.modal||{};a.modal.change=a.modal.change||{};a.modal.change.pw=a.modal.change.pw||{};var h=CAGE.ui.popup,d=CAGE.ajax,m=CAGE.util.template,g=a.account.change.pw;a.modal.change.pw={init:function(){var a=c.querySelector("#change-password"),e=null,l=new h.ajaxPopup({element:a,templateUrl:"/api/v1/templates/changePassword.html",templateLoader:function(a){var d=JSON.parse(a).data.template;e=JSON.parse(a).data.rand;a=c.getElementById("userId").textContent;
return m.getCompiler(d)({randNum:e,email:a},d)}});l.afteropen.add(function(a){var f=new g({method:"PUT",url:"/api/v1/accounts/",form:".form-container",rule:{oldPassword:{type:"password",extend:{exist:[function(a,f){d.POST({isAsync:!1,url:"/api/v1/session",success:function(a){b.log("Success!");f(!0,!0)},failure:function(a){b.log("Failure!");f(!1,!0)},data:function(){var d=escape(c.getElementById("userId").textContent),b=SHA256(SHA256(escape(a.value))+e);return"email\x3d"+d+"\x26password\x3d"+b}()})},
"비밀번호가 다릅니다."]}},newPassword:{type:"password"},newConfirm:{type:"confirm",target:"newPassword"}},randNum:e});l.afterclose.add(f.stop.bind(f));a.querySelector("#change").addEventListener("click",function(a){f.exec(function(){l.afterclose.add(function(){location.reload()});l.close()}.bind(this))},!1);c.querySelector(".form-container input[name\x3doldPassword]").focus()})}};e.WILDGOOSE=a})(this);
(function(e){var c=e.document,b=e.WILDGOOSE||{};b.modal=b.modal||{};b.modal.join=b.modal.join||{};var a=CAGE.ui.popup,h=b.account.join;b.modal.join={init:function(){var d=c.querySelector("#join"),b=new a.ajaxPopup({element:d,templateUrl:"/api/v1/templates/account.html",templateLoader:function(a){return JSON.parse(a).data.template}});b.afteropen.add(function(a){var d=new h({method:"POST",url:"/api/v1/accounts/",form:".form-container",rule:{email:{type:"email"},password:{type:"password"},confirm:{type:"confirm",
target:"password"}}});b.afterclose.add(d.stop.bind(d));a.querySelector("#create").addEventListener("click",function(a){d.exec(function(){b.afterclose.add(function(){location.reload()});b.close()}.bind(this))},!1);c.querySelector(".form-container input[name\x3demail]").focus()})}};e.WILDGOOSE=b})(this);
(function(e){var c=e.document,b=e.WILDGOOSE||{};b.modal=b.modal||{};b.modal.login=b.modal.login||{};var a=CAGE.ajax,h=CAGE.ui.popup,d=CAGE.util.template,m=b.account.login;b.modal.login={init:function(){var b=null,e=c.querySelector("#login"),n=new h.ajaxPopup({element:e,templateUrl:"/api/v1/templates/login.html",templateLoader:function(a){var c=JSON.parse(a).data.template;b=JSON.parse(a).data.rand;return d.getCompiler(c)({randNum:b},c)}});n.afteropen.add(function(d){var e=new m({method:"POST",url:"/api/v1/session/",
form:".form-container",rule:{email:{type:"email",extend:{usable:[function(d,b){a.GET({isAsync:!1,url:"/api/v1/session?email\x3d"+d.value,success:function(a){b(!0,!0)},failure:function(a){b(!1,!0)}})},"가입되지 않은 이메일입니다."]}},password:{type:"password"}},randNum:b});n.afterclose.add(e.stop.bind(e));d.querySelector("#create").addEventListener("click",function(a){e.exec(function(){n.afterclose.add(function(){location.reload()});n.close()}.bind(this))},!1);c.querySelector(".form-container input[name\x3demail]").focus()})}};
e.WILDGOOSE=b})(this);
(function(e){var c=e.document,b=e.WILDGOOSE||{};b.modal=b.modal||{};b.modal.withdraw=b.modal.withdraw||{};var a=CAGE.ui.popup,h=CAGE.util.template,d=b.account.withdraw;b.modal.withdraw={init:function(){var b=c.querySelector("#leave"),e=null,f=new a.ajaxPopup({element:b,templateUrl:"/api/v1/templates/withdraw.html",templateLoader:function(a){var d=JSON.parse(a).data.template;e=JSON.parse(a).data.rand;a=c.getElementById("userId").textContent;return h.getCompiler(d)({randNum:e,email:a},d)}});f.afteropen.add(function(a){var b=
new d({method:"POST",url:"/api/v1/accounts/",form:".form-container",rule:{password:{type:"password"},confirm:{type:"confirm",target:"password"}},randNum:e});f.afterclose.add(b.stop.bind(b));a.querySelector("#withdraw").addEventListener("click",function(a){b.exec(function(){f.afterclose.add(function(){location.reload()});f.close()}.bind(this))},!1);c.querySelector(".form-container input[name\x3dpassword]").focus()})}};e.WILDGOOSE=b})(this);
(function(){var e=window.document,c=window.WILDGOOSE||{};c.search=c.search||{};c.search.more=c.search.more||{};var b=CAGE.ajax,a=CAGE.util.template,h=c.ui.favorite;c.search.more={init:function(a){this.searchMoreBtn=a.button;this.searchResult=a.container;this.requestNum=a.requestNum;this.template=a.template;null!=this.searchMoreBtn&&(this.searchMoreBtn.addEventListener("click",this._more.bind(this),!1),a=e.querySelector(".search-more .state-search-curNum"),a=parseInt(a.innerText),this._selectStatusOfSearchMoreBtn(a))},
_more:function(a){a=e.querySelector(".search-more .state-search-query").innerText;var c=e.querySelector(".search-more .state-search-curNum").innerText;b.GET({url:"/api/v1/search?q\x3d"+a+"\x26start_item\x3d"+c+"\x26how_many\x3d"+this.requestNum,callback:this._responseHandler.bind(this)})},_responseHandler:function(a){a=JSON.parse(a).data.reporters;var b=null!=this._getUserId()?!0:!1;0!=a.length&&(a=this._makeReporterCards(b,a),this._attachRecievedData(a),a=this._updateMetaData(a.length),this._selectStatusOfSearchMoreBtn(a.curNum),
h.updateFavs(a.curNum,this.requestNum),h.attatchEventToFavBtn(a.curNum,this.requestNum))},_updateMetaData:function(a){var b=e.querySelector(".search-more .state-search-curNum");a=parseInt(b.innerText)+a;b.innerText=a;return{curNum:a}},_selectStatusOfSearchMoreBtn:function(a){var b=e.querySelector(".search-more"),c=e.querySelector(".search-more .state-search-totalNum");null===c?b.setAttribute("style","display: none;"):parseInt(c.innerText)<=a&&b.setAttribute("style","display: none;")},_makeReporterCards:function(b,
c){for(var e=a.getCompiler(),f=c.length,h=[],l=0;l<f;l++){var p='\x3cli class\x3d"card card-reporter"\x3e'+e(c[l],this.template)+"\x3c/li\x3e";h.push(p)}return h},_getUserId:function(){var a=e.getElementById("userId");null!=a&&(a=e.getElementById("userId").getAttribute("email"));return a},_attachRecievedData:function(a){this.searchResult.innerHTML+=a.join("")}}})();
(function(){var e=window.console,c=window.WILDGOOSE||{};c.search=c.search||{};c.search.auto_complement=c.search.auto_complement||{};var b=CAGE.ajax;c.search.auto_complement={init:function(a){this.row={requestCount:a.list.requestNum,currentCount:0};this.interval=a.list.interval;this.is={searching:!1,hovering:!1,pressedEnter:!1,listing:!1,highlighting:!1};this.box=a.searchBox;this.list=a.list.element;this.cache={searchedQuery:this.box.value,row:null,callbackRef:{notify:this.notify.bind(this),expired:this.expired.bind(this),
listHandler:this.listHandler.bind(this),drawList:this.drawList.bind(this),setHovering:this.setHovering.bind(this),observeState:this.observeState.bind(this)}};this.box.addEventListener("focus",this.cache.callbackRef.notify);this.box.addEventListener("blur",this.cache.callbackRef.expired)},expired:function(a){!1!=this.is.searching&&!1==this.is.hovering&&(!0==this.is.listing&&this.removeList(),clearInterval(this.is.searching),this.is.searching=!1)},notify:function(a){!1==this.is.searching&&(this.is.searching=
setInterval(this.cache.callbackRef.observeState,this.interval))},observeState:function(){var a=this.box.value;a!=this.cache.searchedQuery&&(e.log("detection: "+a),""==a?this.removeList():this.search(a))},search:function(a){this.cache.searchedQuery=a;b.GET({url:"/api/v1/search?autocomplete\x3dtrue\x26q\x3d"+a+"\x26how_many\x3d"+this.row.requestCount,callback:this.cache.callbackRef.drawList})},drawList:function(a){this.is.pressedEnter=!1;a=JSON.parse(a).data.reporters;e.log(a);if(void 0!==a&&0!=a.length){this.cache.row=
null;this.row.currentCount=a.length;for(var b="",d=0;d<this.row.currentCount;d++)b+="\x3cli\x3e\x3cdiv\x3e"+a[d].name+"\x3c/div\x3e\x3c/li\x3e";this.list.innerHTML=b;this.addList()}},removeList:function(){this.is.listing=!1;this.row.currentCount=0;this.cache.row=null;this.list.style.display="none";this.removeMouseRader(this.list);this.box.removeEventListener("keydown",this.cache.callbackRef.listHandler,!1);this.list.removeEventListener("click",this.cache.callbackRef.listHandler,!1);this.list.removeEventListener("mousemove",
this.cache.callbackRef.listHandler,!1);this.is.hovering=!1},addList:function(){this.is.listing=!0;this.list.style.display="inline-block";this.addMouseRader(this.list);this.box.addEventListener("keydown",this.cache.callbackRef.listHandler,!1);this.list.addEventListener("click",this.cache.callbackRef.listHandler,!1);this.list.addEventListener("mousemove",this.cache.callbackRef.listHandler,!1)},addMouseRader:function(a){a.addEventListener("mouseover",this.cache.callbackRef.setHovering,!1);a.addEventListener("mouseout",
this.cache.callbackRef.setHovering,!1)},removeMouseRader:function(a){a.removeEventListener("mouseover",this.cache.callbackRef.setHovering,!1);a.removeEventListener("mouseout",this.cache.callbackRef.setHovering,!1)},setHovering:function(a){"mouseover"==a.type?this.is.hovering=!0:"mouseout"==a.type&&(this.is.hovering=!1)},listHandler:function(a){var b=a.target;"keydown"==a.type&&b==this.box?(e.log("keydown"),b=a.keyCode,38==b||40==b?(a.preventDefault(),this.highlightRow(39-b)):13==b&&(a.preventDefault(),
this.selectEl(this.list.children[this.cache.row]))):"click"==a.type&&b.parentNode.parentNode==this.list&&!0==this.is.hovering?(this.is.hovering=!1,this.selectEl(a.target)):"mousemove"==a.type&&!0==this.is.highlighting&&this.highlightOut(this.cache.row)},selectEl:function(a){var b=null,b=void 0===a?this.box.value:a.innerText,b=this.removeNewline(b);this.box.value=b;this.cache.searchedQuery=b;this.removeList();this.box.form.submit()},removeNewline:function(a){var b=a.lastIndexOf("\n");return-1==b?a:
a.substring(0,b)},highlightRow:function(a){null==this.cache.row&&(a=this.cache.row=0);var b=this.cache.row;a=b-a;a>=this.row.currentCount?a=0:0>a&&(a=this.row.currentCount-1);this.highlightOut(b);this.highlightIn(a);this.cache.row=a},highlightIn:function(a){this.is.highlighting=!0;this.list.children[a].className="highlight"},highlightOut:function(a){null!==a&&(this.is.highlighting=!1,this.list.children[a].className="")}}})();
(function(){var e=window.WILDGOOSE||{};e.search=e.search||{};e.search.submit=e.search.submit||{};var c=CAGE.util.string;e.search.submit={init:function(b){this.box=b.box;this.form=this.box.form;this.submit=b.box;void 0!==this.form&&this.form.addEventListener("submit",this._handler.bind(this),!1)},_handler:function(b){""===c.trim(this.box.value)&&b.preventDefault()}}})();
(function(){var e=window.document,c=window.WILDGOOSE||{};c.search=c.search||{};var b=CAGE.util.template,a=c.search.more,h=c.search.auto_complement,d=c.search.submit;c.search={init:{init:function(c){var g=c.search;void 0!==g&&(this.form={box:e.querySelector(g.box),container:e.querySelector(g.container)},this.search={submit:e.querySelector(g.submit),requestNum:g.requestNum,templateURL:g.templateURL,template:b.get({url:g.templateURL})},d.init({box:this.form.box,submit:this.search.submit}));g=c.autocompletion;
void 0!==g&&(this.list={element:e.querySelector(c.autocompletion.list),requestNum:g.requestNum,interval:100},h.init({searchBox:this.form.box,list:this.list}));c=c.more;void 0!==c&&(this.more={button:e.querySelector(c.button)},a.init({button:this.more.button,container:this.form.container,template:this.search.template,requestNum:this.search.requestNum}));this.form.box.focus()}}.init}})();